<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>MegxBar Bookmarklet</title>

<link href="$ctx.siteUrl/net.megx.megxbar/css/bookmarklet.css" rel="stylesheet" type="text/css"> 
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> 
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js" type="text/javascript"></script>
<script type="text/javascript" src="$ctx.siteUrl/net.megx.megxbar/js/bookmarkletFunctions.min.js"></script>


</head>

<body style="background-color: hsl(0, 0%, 97%); font-size: small; font-family: Helvetica Neue,Arial,Ubuntu,sanf-serif;">

	<img src="$ctx.siteUrl/images/logo.png" style="padding-left: 35px; padding-top: 15px; height: 99px;"/>
	
		<script>
			var msg;
			var listener = function(event) {
			    //if(event.origin !== "http://thearticle"){
			    //return;
			    //}
			    try {
			        msg = JSON.parse(event.data);
			        if (msg.type && msg.type == "setarticle") {
			            $("#title").html(msg.article.title);
		
			            var auths = msg.article.authors[0];
			            for (var i = 1; i < msg.article.authors.length; i++) {
			                auths = auths + ", " + msg.article.authors[i];
			            }
			            auths = auths + ".";
			            $("#auths").html(auths);
		
			        } else if (msg.type && msg.type == "noarticlefound") {
			            $("#infoMessage").html("No article information found.");
			            $("#submitBookmark").hide();			 
			            $("#bookmarkFormDecimal, #bookmarkFormDegrees, #titleTable").hide();
			            $("#loginCheck").hide();
			            $("#infoMessage").show();
			            
			        } else if (msg.type && msg.type == "wrongdomain") {
			            $("#infoMessage").html("Megxbar can only retriev article information from pubmed webpages, please search for the articel you want to curated with geographic coordinates on pubmed. Then open megxbar again on the " + '<a href="http://www.ncbi.nlm.nih.gov/pubmed" target="_blank">pubmed</a>' + " webpage of your articel. For further information please visit the " + '<a href="$ctx.siteUrl/bookmark-help" target="_blank">help</a>' +" page");
			            $("#submitBookmark").hide();
			            $("#bookmarkFormDecimal, #bookmarkFormDegrees, #titleTable").hide();
			            $("#loginCheck").hide();
			            $("#infoMessage").show();
			        }
			    } catch (e) { /*alert(e);*/ }
			}
		
			if (window.addEventListener) {
			    window.addEventListener("message", listener, false);
			} else {
			    window.attachEvent("onmessage", listener);
			}
		
			if (window != window.parent) {
			    window.parent.postMessage(JSON.stringify({
			        type: "getarticle"
			    }), "*");
			}		
	</script>
	
	<div id="infoMessage"></div>
	
	#if($req.user)
	
	<input type="button" value="Logout" id="logout">

	<div id="message"></div>
	<table id="titleTable">
		<tr>
			<td align="center"><label id="title"></label></td>
		</tr>
		<tr>
			<td align="center" height="80"><label id="auths"></label></td>
		</tr>
		<tr>
			<td align="center" height="30"><label>Geographic location of the study side:</label></td>
		</tr>
		<tr>
			<td>
				<input type="radio" id="decimal" value="decimal" name="rb" checked>
				<span class="caption">I have decimal degrees.</span>
			</td>			
		</tr>
		<tr>
			<td>
				<input type="radio" id="degrees" value="degrees" name="rb" >
				<span class="caption">I have degrees, minutes and seconds.</span>
			</td>			
		</tr>
		<tr>
			<td>
				<input type="radio" id="regionName" value="regionName" name="rb" >
				<span class="caption">I don't know the geographic coordinates.</span>
			</td>			
		</tr>
	</table>
	
	<form id="bookmarkFormDecimal">
		<table>
			<tr>
				<td>
					<label id="latitudeLabel" for="latitude">Latitude:</label>
					<input type="radio" style="margin-left: 15px;" id="north" name="latitude" checked>N+
					<input type="radio" id="south" name="latitude" style="margin-left:9px">S-
					<input class="inputDecimal" type="text" id="latitudeDec" name="latitudeDec" style="margin-left:6px">
				</td>
			</tr>
			<tr>
				<td height="35">
					<label id="longitudeLabel" for="longitude">Longitude:</label>
					<input type="radio" name="longitude" id="east" checked>W-
					<input type="radio" name="longitude" id="west" style="margin-left: 9px;">E+
					<input class="inputDecimal" style="margin-left: 2px;" type="text" id="longitudeDec" name="longitudeDec">
				</td>
			</tr>
			<tr>
				<td align="center"><span style ="font-style: italic;">(Please use the coordinates of the study site the article relates to and not the location of the university. For further information please visit <a href="$ctx.siteUrl/bookmark-help" target="_blank">Help</a> section)</span></td>
			</tr>
		</table>
	</form>
	
	<form style="display: none" id="bookmarkFormDegrees">
		<table>
			<tr>
				<td>
					<label id="latitudeLabelDegrees">Latitude:</label>
					<input type="radio" name="degLatitude" id="degNorth" style="margin-left:10px" checked>N+
					<input type="radio" name="degLatitude" id="degSouth" style="margin-left:1px">S-
					<input maxlength="2" class="inputDegrees" style="margin-left: 7px;" type="text" id="latitudeDeg" name="latitudeDeg">°
					<input maxlength="2" class="inputDegrees" type="text" id="latitudeMin" name="latitudeMin">'
					<input maxlength="6" class="inputDegrees" type="text" id="latitudeSec" name="latitudeSec">"
					<span id="latitudeDegMsg" class="coordinatesErrorMsg"></span>
				</td>
			</tr>
			<tr>
				<td height="35">
					<label id="longitudeLabelDegrees">Longitude:</label>
					<input type="radio" name="degLongitude" id="degEast" style="margin-left:0px" checked>W-
					<input type="radio" name="degLongitude" id="degWest" style="margin-left: 1px">E+
					<input maxlength="3" class="inputDegrees" type="text" id="longitudeDeg" name="longitudeDeg" style="margin-left: 2px;">°
					<input maxlength="2" class="inputDegrees" type="text" id="longitudeMin" name="longitudeMin">'
					<input maxlength="6" class="inputDegrees" type="text" id="longitudeSec" name="longitudeSec">"
					<span id="longitudeDegMsg" class="coordinatesErrorMsg"></span>
				</td>
			</tr>
			<tr>
				<td align="center"><span style ="font-style: italic;">(Please use the coordinates of the study site the article relates to and not the location of the university. For further information please visit <a href="$ctx.siteUrl/bookmark-help" target="_blank">Help</a> section)</span></td>
			</tr>
		</table>
	</form>
	
	<form style="display: none" id="bookmarkFormRegionName">
		<table>
			<tr>
				<td>
					<label id="placeTypeLabel">Select Country/Sea:</label>
					<select id="placeTypeSelect">
					  <option value="country">Country</option>
					  <option value="sea">Sea</option>
					</select>
				</td>
			</tr>
			<tr>
				<td height="35">
					<label id="placeNameLabel">Enter Place Name:</label>
					<input type="text" id="placeName" name="placeName">
				</td>
			</tr>
			<tr>
				<td align="center"><span style ="font-style: italic;">(Please use the coordinates of the study site the article relates to and not the location of the university. For further information please visit <a href="$ctx.siteUrl/bookmark-help" target="_blank">Help</a> section)</span></td>
			</tr>
		</table>
	</form>

	<table>
		<tr>
			<td>
				<input id="submitBookmark" type="button" value="Save">
			</td>
		</tr>
		<tr>
			<td>
			 	<a href="http://www.geonames.org/" target="_blank">
				  <img src="$ctx.siteUrl/net.megx.megxbar/images/geonames_logo.PNG" class="geoNamesLogo"/>
				</a>
			</td>
		</tr>
	</table>
	
	
	
	
	#else
	#* not logged in *#
	
	<div id="loginCheck" style="padding-left: 55px;">
		<a href="#" onclick="login()" class="button">Login to megx.net</a>
	</div>
	<script>
		var loginWindow = null;
	
		function login() {
	
		    if (loginWindow == null || loginWindow.closed) {
		        loginWindow = window.open("$ctx.siteUrl/login?redirectURL=/continue", "Login", "location=0, menubar=0, top=250, left=270, width=700, height=480");
		    } else {
		        loginWindow.focus();
		    }
		}
	</script>  
		
	#end 
	
</body>
</html>